<!DOCTYPE html>
<!-- saved from url=(0102)file:///home/gknam/Documents/Programming/CS50_finalProject/mashup/templates/test_plots_Horizontal.html -->
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>D3 test</title>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script type="text/javascript" src="d3.v4.min.js"></script>
    <!--  "style" tag seems to override those in "script" tag below.
        To test this, uncomment "width" in "style".
         -->
    <style type="text/css">
    /*    .bar {
        fill: steelblue;
    }*/
    
    .axis text {
        /*  */
        fill: black;
        /* Without this, the text "Frequency" is not visible. */
        font: 10px sans-serif;
    }
    
    .axis path .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }
    
    svg {
        display: block;
        margin: left;
    }
    </style>
</head>

<body>
    <!-- http://getbootstrap.com/css/#forms -->
    <form id="form">
        <div class="form-group">
            <b>Type in a keyword!</b>
            <label class="sr-only" for="q">Keyword</label>
            <input class="form-control" id="q" placeholder="Keyword" type="text" autofocus="">
        </div>
    </form>
    <script type="text/javascript">
    data = {
        "4": [{
            "Boylan, Geraldine B": [{
                "total": 4
            }, {
                "journals": {
                    "Dev Neurosci": 1,
                    "J Pediatr": 2,
                    "Med Eng Phys": 1
                }
            }, {
                "years": {
                    "2017": 4
                }
            }]
        }, {
            "Dani, Carlo": [{
                "total": 4
            }, {
                "journals": {
                    "Ital J Pediatr": 1,
                    "J Matern Fetal Neonatal Med": 1,
                    "Neuropediatrics": 1,
                    "Transfusion": 1
                }
            }, {
                "years": {
                    "2017": 4
                }
            }]
        }],
        "5": [{
            "Lee, Shoo K": [{
                "total": 5
            }, {
                "journals": {
                    "Acta Paediatr": 1,
                    "Am J Perinatol": 1,
                    "Arch Dis Child Fetal Neonatal Ed": 1,
                    "Br J Ophthalmol": 1,
                    "JAMA Pediatr": 1
                }
            }, {
                "years": {
                    "2017": 5
                }
            }]
        }],
        "6": [{
            "Shah, Prakesh S": [{
                "total": 6
            }, {
                "journals": {
                    "Acta Paediatr": 1,
                    "Am J Perinatol": 2,
                    "Br J Ophthalmol": 1,
                    "J Matern Fetal Neonatal Med": 1,
                    "JAMA Pediatr": 1
                }
            }, {
                "years": {
                    "2017": 6
                }
            }]
        }, {
            "Vento, Maximo": [{
                "total": 6
            }, {
                "journals": {
                    "Acta Paediatr": 2,
                    "Br J Ophthalmol": 1,
                    "Cochrane Database Syst Rev": 1,
                    "J Pediatric Infect Dis Soc": 1,
                    "Redox Biol": 1
                }
            }, {
                "years": {
                    "2017": 6
                }
            }]
        }]
    }


    var pl1 = []; // authors (x-axis) and number of publications (y-axis)
    var pl2 = []; // years (x-axis) and number of publications (y-axis)

    // each publication
    for (i in data) {
        // authors
        for (j of data[i]) {
            // each author
            for (k in j) {
                // plot 1 data
                var auPubs = parseInt(j[k][0]["total"]);
                pl1.push({
                    "y": k, // author
                    "x": auPubs // publications count for author
                });

                // plot 2 data (per author)
                var years = Object.keys(j[k][2]["years"]);
                var yearPubs = Object.values(j[k][2]["years"]);
                pl2.push({
                    "y": years,
                    "x": yearPubs // publication count per year
                });
            }
        }
    }

for (var i = 0; i < 4; i++) {
    pl2.pop();
}


    $(drawBarChart(pl1, "pl1"));
    $(drawBarChart(pl2, "pl2"));

    function drawBarChart(plotData, className) {
        // determine number of ticks on X-axis (number of publications)
        var xAxis_max = d3.max(plotData, function(d) {
            return d.x
        });

        var xTicks;

        if (xAxis_max % 5 > 0) {
            xTicks = xAxis_max + 5 - (xAxis_max % 5);
        } else {
            xTicks = xAxis_max;
        }

        // bar chart (svg)
        // width, height and paddings
        var margin = {
                top: 20,
                right: 30,
                bottom: 40,
                left: 30
            },
            w = 1200 - margin.left - margin.right,
            h = 300 - margin.top - margin.bottom;

        var barOrigin = 400;
        var barP = h * 0.01; // "P" for padding
        var barHeight = (plotData.length > 1) ? h / plotData.length - barP : 80; // http://stackoverflow.com/a/10926907

        var fontSize = w / 50;

        // var sideP = w * 0.01;

        // Create SVG element
        var svg1 = d3.select("body")
            .append("svg")
            .attr("width", w + margin.left + margin.right)
            .attr("height", h + margin.top + margin.bottom)
            .attr("class", className);

        // scales
        /*    var yScale = d3.scaleLinear()
                .domain([0, plotData.length])
                .range([sideP, w - sideP]);*/

        var xScale = d3.scaleLinear()
            .domain([0, xAxis_max])
            .range([0, w - barOrigin]);


        // Define X axis
        var xAxis = d3.axisBottom()
            .scale(xScale)
            .ticks(xAxis_max) // Set rough # of ticks
            // .tickFormat(formatAsPercentage);

        // Add chart
        var chart = svg1.append("g")
            .attr("class", "chart")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // Add bar groups (bars + texts)
        var bar = chart.selectAll("g")
            .data(plotData)
            .enter()
            .append("g")
            .attr("class", "bar")
            .attr("transform", function(d, i) {
                if (plotData.length > 1) {
                    return "translate(" + barOrigin + "," + (i * (barHeight + barP)) + ")";                    
                }
                else {
                    return "translate(" + barOrigin + "," + (h / 2 - barHeight / 2) + ")";
                }
            });

        // Add bars
        bar.append("rect")
            .attr("class", function(d) {
                return d.y;
            })
            .attr("width", function(d) {
                return d.x * (w / xAxis_max) - barOrigin;
            })
            .attr("height", barHeight)
            .attr("fill", "#e600e6");

        // Add text (number of publications)
        bar.append("text")
            .attr("x", function(d) {
                return d.x * (w / xAxis_max) - barOrigin - fontSize;
            })
            .attr("y", function(d, i) {
                return (barHeight) / 2 + fontSize * (1 / 3);
            })
            .attr("class", "pubNum")
            .style("font-family", "sans-serif")
            .style("font-size", fontSize)
            .style("font-weight", "bold")
            .attr("fill", "black")
            .style("text-anchor", "middle")
            .text(function(d) {
                return d.x;
            });

        // Add text (y axis)
        bar.append("text")
            .text(function(d) {
                return d.y;
            })
            .attr("x", function(d) {
                return -fontSize / 2;
            })
            .attr("y", function(d, i) {
                return (barHeight) / 2 + fontSize * (1 / 3);
            })
            .style("font-family", "sans-serif")
            .style("font-size", fontSize + "px")
            .style("font-weight", "bold")
            .attr("fill", "black")
            .style("text-anchor", "end");



        // Create X axis
        chart.append("g")
            .attr("class", "axis") // Assign "axis" class
            .call(xAxis)
            .attr("transform", "translate(" + barOrigin + "," + (h + 50) + ")")
            .append("text")
            .attr("y", -(fontSize * (4 / 3)))
            .attr("x", (w - barOrigin) / 2)
            .attr("dy", ".71em")
            .style("text-anchor", "middle") // this can go into <style> --> ".axis text" as "text-anchor: end;"
            .style("font-size", fontSize)
            .style("font-weight", "bold")
            .text("Number of publications");


        $("rect, .pubNum")
            .mouseover(function() {
                // bar
                if ($(this).prop("tagName") == "rect") { // http://stackoverflow.com/a/5347371
                    $(this).attr("fill", "green");
                }
                // text in bar
                else {
                    $(this).closest(':has(rect)').find('rect').attr("fill", "green"); // http://stackoverflow.com/a/2679026
                }
            })
            .mouseleave(function() {
                if ($(this).prop("tagName") == "rect") {
                    $(this).attr("fill", "#e600e6");
                } else {
                    $(this).closest(':has(rect)').find('rect').attr("fill", "#e600e6");
                }
            })
            .click(function() {
                console.log(jQuery(this)[0].__data__["x"]);
            });

        /*
            // Define Y axis
            var yAxis = d3.axisLeft()
                .scale(yScale)
                .ticks(3) // Set rough # of ticks
                // .tickFormat(formatAsPercentage);

            // Create Y axis
            svg1.append("g")
                .attr("class", "axis")
                .call(yAxis)
                .transition()
                .duration(500)
                .attr("transform", "translate(" + sideP + ", 0)");
        */
        // data for plot 2 (journals and number of publications)



    }
    </script>
</body>

</html>
